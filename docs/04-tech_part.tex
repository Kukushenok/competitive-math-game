\chapter{Технологическая часть}

Существуют следующие реляционные СУБД~\cite{dbanalyse}:
\begin{itemize}
	\item SQLite;
	\item Oracle;
	\item Microsoft SQL Server;
	\item PostgreSQL. 
\end{itemize}
Были составлены следующие критерии:
\begin{itemize}
	\item поддержка проверки регулярных выражений (К1);
	\item возможность создания перечисляемого типа (К2);
	\item открытость исходного кода (К3);
	\item возможность обработки ошибок в хранимых процедурах (К4).
\end{itemize}
Сравнение СУБД представлено в таблице~\ref{tbl:dbms_compr}. 
\begin{table}[h!]
	\centering
	\caption{\label{tbl:dbms_compr}Сравнение существующих СУБД}
	\begin{tabular}{|l|l|l|l|l|}
		\hline
		& К1 & К2 & К3 & K4\\\hline
		SQLite & -- & -- & + & --\\\hline
	 	Oracle & + & + & -- & + \\\hline
		Microsoft SQL Server & -- & -- & -- & +\\\hline
		PostgreSQL & + & + & + & + \\\hline
	\end{tabular}
\end{table}

Исходя из результатов сравнения была выбрана PostgreSQL~\cite{postgresql}, поскольку в ней представлены все необходимые возможности для создания реляционной базы данных, в частности создание хранимых процедур и ролевой системы.

Для реализации был выбран язык C\# версии 12, поскольку в нём представлены все необходимые возможности для создания Web-интерфейса взаймодействия с приложением, в частности, с помощью фреймворка ASP.NET Core~\cite{aspnet}.

%Для связи объектов базы данных с кодом программы использовался фреймворк EF Core~\cite{efcore}.

Для обработки изображений была выбрана библиотека Magick.NET~\cite{magicknet}. 

Для хранения и выполнения отложенных задач использовалась библиотека Quartz.NET~\cite{quartznet}.

\section{Компоненты программного обеспечения}
На рисунке~\ref{scheme:components} представлена диаграмма компонентов приложения.
\scheme{components}{Диаграмма компонентов приложения}

Модуль Core содержит определение базовых объектов в виде классов, с которыми работает компонент доступа к базе данных и компонент бизнес-логики.

Модуль Repositories содержит интерфейсы, определяющие взаимодействия с базой данных. 

Модуль RepositoriesRealisation содержит реализацию уровня взаимодействия с базой данных. 

Модуль Services содержит интерфейсы, определяющие уровень бизнес-логики, а также сервиса постановки задач с отложенным ожиданием и сервиса обработки изображений.

Модуль ChronoServiceRealisation содержит реализацию сервиса постановки задач с отложенным ожиданием.

Модуль ImageProcessorRealisation содержит реализацию сервиса обработки изображений.

Модуль ServicesRealisation содержит реализацию уровня бизнес-логики на основе интерфейсов компонентов доступа к базе данных.

Модуль BackendUsage содержит интерфейсы, определяющие взаимодействие с приложением в общем виде.

Модуль BaseUsage содержит реализацию взаимодействия с приложением в общем виде на основе интерфейсов уровня бизнес-логики.

Модуль WebBackend реализует сетевое взаимодействие на основе интерфейсов взаимодействия с приложением в общем виде.

Модуль TechnologicalUIHost реализует взаимодействие в виде консольного интерфейса на основе интерфейсов взаимодействия с приложением в общем виде. Также он определяет интерфейс, описывающий консольный ввод-вывод.

Модуль TechnologicalUI содержит реализацию консольного ввода-вывода и предоставляет  консольный интерфейс.

Модуль SolutionInstaller настраивает внедрение зависимостей, сопоставляя всем интерфейсам взаимодействия базы данных, бизнес~--~логики и т.д. с их реализациями.

\section{Тестирование}

Для реализации компонента бизнес~--~логики были разработаны модульные тесты. Для имитирования объектов слоя доступа к базы данных использовалась библиотека Moq~\cite{moq}. Составлен 81~тест, обеспечивающие покрытие кода~---~82.8~\%. Все тесты пройдены успешно.

Для реализации компонента взаимодействия с базой данных были разработаны интеграционные тесты. Для создания независимых образов базы данных использовалась библиотека Testcontainers~\cite{testcontainers}. 
Для тестирования хранимой процедуры составлены следующие классы эквивалентности:
\begin{itemize}
	\item по корректности данных:
	\begin{itemize}
		\item соревнования не существует;
		\item соревнование существует, но оно уже завершено;
		\item соревнование существует и ещё не завершено.
	\end{itemize}
	\item по критериям выдаваемых наград:
	\begin{itemize}
		\item соревнование не имеет выдаваемых наград;
		\item соревнование имеет выдаваемые награды по месту;
		\item соревнование имеет выдаваемые награды по рангу;
		\item соревнование имеет выдаваемые награды различных критериев.
	\end{itemize}
	\item по заявкам соревнования:
	\begin{itemize}
		\item в соревновании никто не участвовал;
		\item в соревновании все заявки имеют различные результаты;
		\item в соревновании присутствуют заявки с одинаковыми результатами, но разными временами последнего обновления.
	\end{itemize}
\end{itemize}
Составлено 124~теста, 17 из которых направлено на тестирование хранимой процедуры. Тесты обеспечивают покрытие кода~---~80.35~\%. Все тесты пройдены успешно.

Для реализации компонента обработки изображений были разработаны функциональные тесты. На вход компоненту поступают файлы из папки Tests с различными названиями:
\begin{itemize}
	\item если файл имеет префикс neg, то обработка должна выдать исключение; результат не сохраняется.
	\item в противном случае, ожидается, что обработка изображения должна пройти успешно; при этом результат сохраняется в соседнюю папку Results.
\end{itemize}
Составлено 15 тестов, которые обеспечивают 100~\% покрытие кода класса обработки изображений. Все тесты пройдены успешно.

Для реализации компонента отложенных задач были разработаны интеграционные тесты. Составлено 7~тестов, которые обеспечивают 100~\% покрытие кода класса отложенных задач. Все тесты пройдены успешно.


\section{Примеры работы}
На рисунках~\ref{scr:sc1}~--~\ref{scr:sc4} приведены примеры обращения к Web~--~интерфейсу программы.

На рисунке~\ref{scr:sc1} пользователь отправляет свой логин, пароль и почту для регистрации в базе данных. После успешной регистрации ему возвращается идентификатор пользователя, роль, а также ключ авторизации. 
\scr{sc1}{Демонстрация регистрации в приложении}
\FloatBarrier
На рисунке~\ref{scr:sc2} пользователь отправляет своё имя и описание для изменения данных о себе. При этом, ключ авторизации пользователя содержится в заголовке запроса.
\scr{sc2}{Демонстрация изменения профиля}
\FloatBarrier
На рисунке~\ref{scr:sc3} пользователь участвует в соревновании, отправляя свой результат соревнованию с известным идентификатором. При этом, ключ авторизации пользователя содержится в заголовке запроса.
\scr{sc3}{Демонстрация участия в соревновании}
\FloatBarrier
На рисунке~\ref{scr:sc4} пользователь получает информацию о таблице лидеров соревнования~---~соответствие профилей игроков и их результатов. По желанию, он может ограничить количество данных для чтения, указав параметры при запросе page и count.
\scr{sc4}{Демонстрация просмотра таблицы лидеров}
\FloatBarrier

\section*{Вывод}

Были выбраны средства реализации базы данных и приложения. Реализованы все компоненты Описаны методы тестирования разработанной функциональности и разработаны тесты для проверки корректности работы приложения. Все тесты пройдены успешно.

\clearpage
